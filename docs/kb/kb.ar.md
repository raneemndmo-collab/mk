# قاعدة المعرفة الإدارية — المفتاح الشهري

> آخر تحديث: 2026-02-26 | الإصدار: 1.0

---

## 1. الأدوار والصلاحيات {#roles}

| الدور | الوصف | الصلاحيات الرئيسية |
|-------|-------|-------------------|
| **مدير (Admin)** | مدير المنصة الكامل | كل الصلاحيات: إدارة المستخدمين، العقارات، الحجوزات، الإعدادات، قاعدة المعرفة |
| **موظف (Staff)** | موظف دعم فني | عرض المستخدمين، إدارة الحجوزات، الرد على الرسائل، طلبات الصيانة |
| **مالك (Landlord)** | مالك عقار | إضافة/تعديل عقاراته، قبول/رفض الحجوزات، التواصل مع المستأجرين |
| **مستأجر (Tenant)** | مستأجر | البحث، الحجز، طلب صيانة، التواصل مع المالك |

### إدارة الصلاحيات
- المسار: `/admin/permissions`
- يمكن تخصيص صلاحيات كل دور بشكل دقيق
- الصلاحيات المتاحة: MANAGE_USERS, MANAGE_PROPERTIES, MANAGE_BOOKINGS, MANAGE_CITIES, MANAGE_KNOWLEDGE, MANAGE_SETTINGS

---

## 2. إجراءات التشغيل (SOPs) {#sops}

### 2.1 إدارة العقارات {#property-management}

#### إضافة عقار جديد
1. المالك يضغط "أضف عقارك" من القائمة
2. يملأ البيانات بالعربي والإنجليزي:
   - العنوان والوصف
   - النوع (شقة/فيلا/استوديو/دوبلكس/غرفة مفروشة/كمباوند/شقة فندقية)
   - السعر الشهري والتأمين
   - عدد الغرف والحمامات والمساحة
   - المرافق (مواقف، مسبح، صالة رياضية، إلخ)
   - قواعد السكن
3. يرفع الصور (حد أقصى 10 صور، كل صورة أقل من 5MB)
4. يرسل للمراجعة → الحالة: "قيد المراجعة"
5. المدير يراجع ويوافق أو يرفض مع ذكر السبب

#### تحديث عقار
- المالك يعدل من لوحة التحكم → عقاراتي → تعديل
- التعديلات الجوهرية (السعر، الصور) تحتاج مراجعة جديدة

#### حالات العقار
| الحالة | الوصف |
|--------|-------|
| مسودة (draft) | لم يُرسل للمراجعة بعد |
| قيد المراجعة (pending) | بانتظار موافقة المدير |
| نشط (active) | معروض للمستأجرين |
| غير نشط (inactive) | مخفي مؤقتاً |
| مرفوض (rejected) | مرفوض مع سبب |

### 2.2 إدارة الحجوزات {#bookings}

#### دورة حياة الحجز
1. المستأجر يطلب الحجز → الحالة: "معلق"
2. المالك يوافق أو يرفض
3. بعد الموافقة → المستأجر يدفع (تأمين + إيجار أول شهر + رسوم خدمة 5%)
4. بعد الدفع → الحالة: "مؤكد"
5. عند الدخول → الحالة: "نشط"
6. عند المغادرة → الحالة: "مكتمل"

#### إلغاء الحجز
- قبل الموافقة: إلغاء مجاني
- بعد الموافقة وقبل الدفع: إلغاء مجاني
- بعد الدفع: يخضع لشروط العقد

### 2.3 طلبات الصيانة الطارئة {#emergency-maintenance}

#### إنشاء طلب طوارئ
1. المسار: `/admin/emergency-maintenance`
2. اختر العقار والمستأجر
3. حدد الفئة: سباكة، كهرباء، تكييف، أمان، حريق، أخرى
4. حدد الأولوية: عادي، مهم، طارئ، حرج
5. أرفق صور/فيديو إذا لزم
6. عيّن فني الصيانة

#### تتبع الطلب
| الحالة | الوصف |
|--------|-------|
| مقدم (submitted) | تم تقديم الطلب |
| مُستلم (acknowledged) | تم استلام الطلب من الفريق |
| قيد التنفيذ (in_progress) | الفني يعمل على الإصلاح |
| مكتمل (completed) | تم الإصلاح |
| ملغي (cancelled) | تم إلغاء الطلب |

### 2.4 سير عمل الرسائل {#messaging}

- المستأجر والمالك يتواصلون عبر نظام الرسائل الداخلي
- المسار: `/messages`
- المدير يمكنه مراقبة جميع المحادثات
- الإشعارات تُرسل تلقائياً عند رسالة جديدة

### 2.5 واتساب {#whatsapp}

#### تفعيل/تعطيل
- المسار: `/admin/settings` → تبويب واتساب
- تفعيل/تعطيل زر واتساب العائم
- تحديد رقم واتساب
- تخصيص رسالة الترحيب

#### قوالب الرسائل
- رسالة استفسار عن عقار
- رسالة طلب حجز
- رسالة طلب صيانة

---

## 3. استكشاف الأخطاء {#troubleshooting}

### 3.1 الصور لا تظهر {#photos-not-showing}
**الأسباب المحتملة:**
- الصورة أكبر من 5MB → اطلب من المالك تصغيرها
- صيغة غير مدعومة → يجب أن تكون JPG أو PNG أو WebP
- رابط الصورة معطل → تحقق من رابط S3/التخزين
- مشكلة في الكاش → امسح كاش المتصفح

**الحل:**
1. تحقق من حجم وصيغة الصورة
2. جرب رفع الصورة مرة أخرى
3. إذا استمرت المشكلة، تحقق من سجلات الخادم

### 3.2 الفلاتر لا تعمل {#filters-not-working}
**الأسباب المحتملة:**
- لا توجد عقارات تطابق الفلاتر → وسّع نطاق البحث
- مشكلة في الاتصال بقاعدة البيانات → تحقق من سجلات الخادم
- كاش قديم → امسح كاش المتصفح

### 3.3 مشاكل OTP {#otp-issues}
**الأسباب المحتملة:**
- رقم الجوال غير صحيح → تحقق من الرقم مع رمز الدولة (+966)
- مزود OTP معطل → تحقق من إعدادات مزود الرسائل
- OTP منتهي الصلاحية → اطلب رمز جديد (صالح لمدة 5 دقائق)

### 3.4 مشاكل الصلاحيات {#permission-issues}
- تحقق من دور المستخدم في `/admin/permissions`
- تأكد أن الصلاحية المطلوبة مفعلة للدور
- إذا كان المستخدم مالك، تأكد أن العقار مسجل باسمه

---

## 4. أسئلة داخلية شائعة {#internal-faq}

### كيف أضيف مدينة جديدة؟
1. عدّل ملف `shared/service_areas.ts`
2. أضف المدينة مع الأحياء
3. ارفع التغييرات → Railway يعيد النشر تلقائياً

### كيف أحدّث قاعدة المعرفة؟
1. عدّل ملفات `docs/kb/kb.ar.md` و `docs/kb/kb.en.md`
2. ارفع التغييرات → المعرفة تتحدث عند النشر

### كيف أغيّر صورة/فيديو الهيرو؟
1. من لوحة الإدارة → الإعدادات → تبويب "الهيرو"
2. اختر نوع الخلفية (صورة أو فيديو)
3. ارفع الملف أو أدخل الرابط
4. اضبط شفافية التعتيم
5. احفظ

### كيف أتعامل مع شكوى مستأجر؟
1. تحقق من تفاصيل الحجز والعقار
2. تواصل مع المالك عبر الرسائل
3. إذا كانت صيانة طارئة، أنشئ طلب طوارئ
4. تابع حتى الحل وأبلغ المستأجر

---

## 5. قوالب الردود {#response-templates}

### رد على استفسار عام
> مرحباً! شكراً لتواصلك مع المفتاح الشهري. كيف أقدر أساعدك؟

### رد على شكوى
> نعتذر عن الإزعاج. سنتابع موضوعك فوراً ونرد عليك خلال 24 ساعة.

### رد على طلب صيانة طارئ
> تم استلام طلبك. فريق الصيانة سيتواصل معك خلال ساعة واحدة.

### رد على سؤال عن مدينة غير متاحة
> حالياً نخدم الرياض فقط. جدة والمدينة المنورة قادمة قريباً — سنبلغك فور الإطلاق.

---

## 6. المصطلحات {#glossary}

| المصطلح | التعريف |
|---------|---------|
| **إيجار شهري** | عقد إيجار لمدة شهر واحد أو أكثر |
| **تأمين** | مبلغ مسترد يُدفع عند الحجز ويُعاد عند المغادرة |
| **رسوم خدمة** | 5% من قيمة الإيجار تُدفع للمنصة |
| **OTP** | رمز تحقق يُرسل للجوال عند التسجيل |
| **CMS** | نظام إدارة المحتوى — إعدادات المنصة |
| **KB** | قاعدة المعرفة — هذا المستند |
| **SOP** | إجراء تشغيل قياسي |
| **FAB** | زر عائم (Floating Action Button) — واتساب/المساعد الذكي |
