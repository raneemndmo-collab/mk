# ════════════════════════════════════════════════════════════════
# MK Platform — Environment Variables
# Copy to .env and fill in values.
#
# SAFETY: All feature flags default to OFF (safest).
# SAFETY: All modes default to standalone (each site independent).
# ════════════════════════════════════════════════════════════════

# ── Database ─────────────────────────────────────────────────
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/mk_platform
REDIS_URL=redis://localhost:6379

# ── Beds24 API V2 ───────────────────────────────────────────
BEDS24_API_URL=https://api.beds24.com
BEDS24_REFRESH_TOKEN=
BEDS24_WEBHOOK_SECRET=                # HMAC SHA-256 shared secret for webhook signature verification
BEDS24_WEBHOOK_IP_ALLOWLIST=          # Comma-separated IPs allowed to send webhooks (empty=disabled, rely on HMAC only)

# ── Mode Switches (standalone | integrated) ──────────────────
# standalone = adapter calls Beds24 directly, hub-api rejects writes (409)
# integrated = hub-api calls Beds24, adapter rejects writes (409)
# INVARIANT: Exactly ONE writer per brand at any time.
MODE_COBNB=standalone
MODE_MONTHLYKEY=standalone
MODE_OPS=standalone

# ── Feature Flags (all OFF by default = safest) ─────────────
# ENABLE_BEDS24:            Initialize Beds24 SDK in hub-api
# ENABLE_BEDS24_WEBHOOKS:   Accept webhooks (200+queue) vs reject (204)
# ENABLE_BEDS24_PROXY:      Admin proxy to Beds24 (ADMIN role only)
# ENABLE_AUTOMATED_TICKETS: Auto-create cleaning tickets on checkout
# ENABLE_PAYMENTS:          Payment endpoints active
# ENABLE_BANK_TRANSFER:     Bank transfer payment option visible
ENABLE_BEDS24=false
ENABLE_BEDS24_WEBHOOKS=false
ENABLE_BEDS24_PROXY=false
ENABLE_AUTOMATED_TICKETS=false
ENABLE_PAYMENTS=false
ENABLE_BANK_TRANSFER=false

# ── Payments (Moyasar) ──────────────────────────────────────
MOYASAR_API_KEY=
MOYASAR_PUBLISHABLE_KEY=
MOYASAR_WEBHOOK_SECRET=

# ── JWT / Auth ───────────────────────────────────────────────
JWT_SECRET=change-me-in-production
JWT_EXPIRES_IN=7d

# ── Service Ports ────────────────────────────────────────────
PORT_HUB_API=4000
PORT_COBNB_ADAPTER=4001
PORT_MK_ADAPTER=4002
PORT_WORKER=4003
PORT_COBNB_WEB=3000
PORT_MK_WEB=3001
PORT_OPS_WEB=3002

# ── Admin Proxy Rate Limit ───────────────────────────────────
# Max requests per minute per admin user to Beds24 proxy
ADMIN_PROXY_RATE_LIMIT=30

# ── Webhook Processing ──────────────────────────────────────
# Max retry attempts before dead-letter (default: 5)
WEBHOOK_MAX_RETRIES=5

# ── Logging ──────────────────────────────────────────────────
LOG_LEVEL=info
NODE_ENV=development
